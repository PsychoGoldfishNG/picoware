var _Manifests={microgames:{psychogoldfish:{push_the_button:{name:"Push the Button",sceneClass:"microgames.psychogoldfish.push_the_button",input:"gamepad",hint:"Push Da Button!",jsFiles:["push-the-button.js"],images:[{key:"button_up",image:"button_up.png"},{key:"button_down",image:"button_down.png"},{key:"finger",image:"finger.png"}],credits:[{credit:"designer",name:"PsychoGoldfish"}]}}}};function loaderScript(s){"use strict";return new Promise(function(A,e){let t=document.createElement("script");t.type="text/javascript",t.async=!0,t.addEventListener("error",e),t.addEventListener("load",A),t.src=s,document.head.appendChild(t)})}function containsAny(A,e){"use strict";for(var t=0;t!=e.length;t++){var s=e[t];if(-1!=A.indexOf(s))return s}return null}var __safariSoundHack=(()=>{"use strict";let t=document.createElement("audio");return document.body.appendChild(t),t.src="data:audio/x-wav;base64,UklGRooWAABXQVZFZm10IBAAAAABAAEAIlYAAESsAAACABAAZGF0YWYWAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",(A,e)=>{t.onended=()=>{e?A.call(e):A()},t.play()}})();const BrowserHelper={isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)||/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.platform)},isIOS:function(){return this.isMobile()&&this.isSafari()},isSafari:function(){return-1<navigator.userAgent.indexOf("Safari")}},GameWrapper={VIEW_GAME:"game",view:"game",layoutDesktop:{baseWidth:960,baseHeight:540,screenSize:524,screenTop:8,characterFrameWidth:320,characterFrameHeight:580,characterWidth:160,characterHeight:290,logoWidth:320,logoHeight:180},layoutGBC:{baseWidth:720,baseHeight:1280,screenSize:524,screenTop:64,screenFrameWidth:662,screenFrameHeight:714,screenFrameTop:29,mainButtonFrameTop:775,mainButtonFrameHeight:212,mainButtonSize:140,mainButtonMargin:-7,smallButtonFrameTop:1058,smallButtonWidth:212,smallButtonHeight:55,smallButtonSize:92,inputMarginX:40,dPadSize:192,dPadDeadzone:10,AbButtonWidth:239,AbButtonHeight:162,speakerWidth:154,speakerHeight:162},layoutGBA:{baseWidth:1280,baseHeight:720,screenSize:524,screenTop:52,screenFrameWidth:654,screenFrameHeight:666,screenFrameTop:18,inputWidth:261,inputMarginX:46,inputTop:158,topInputHeight:236,bottomInputHeight:243,dPadSize:192,dPadDeadzone:10,AbButtonWidth:239,AbButtonHeight:162,mainButtonSize:140,mainButtonMargin:-7,smallButtonWidth:193,smallButtonHeight:144,smallButtonSize:59,smallButtonLeft:129,startButtonTop:17,selectButtonTop:81,ledTop:89,ledSize:56,speakerWidth:167,speakerHeight:134},gameTimerFrames:16,gameTimerSteps:8,gameTimerFlickerFrames:2,gameTimerFlickerFrame:0,gameTimerStep:0,gameTimerWidth:0,gameTimerHeight:0,gameTimerInterval:null,getOffset:function(A){for(var e={top:0,left:0};isNaN(A.offsetLeft)||(e.left+=A.offsetLeft),isNaN(A.offsetTop)||(e.top+=A.offsetTop),A=A.offsetParent;);return e},init:function(A){var m=this;function d(A,e){return m.inputs[A].touch===e.identifier&&(m.inputs[A].touch=!1,"dpad"==A?(m.ui.up=!1,m.ui.down=!1,m.ui.left=!1,m.ui.right=!1,m.dPadHighlight.style.display="none"):(e=A.toLowerCase()+"Button",m[e].style.display="none",m.ui[A]=!1),m.onInputChanged.call(m.onInputChangedThisArg,m.ui),1)}function e(A){for(var e=0;e<A.changedTouches.length;e++){var t=A.changedTouches[e];if("touchcancel"==A.type||"touchend"==A.type)for(var[s,i]of Object.entries(m.inputs))d(s,t)&&A.preventDefault();else for(var[a,n]of Object.entries(m.inputs)){var r=Math.abs(t.clientX-n.x),o=Math.abs(t.clientY-n.y),h=n.size/2,l=9999;r<=h&&o<=h&&(l=Math.sqrt(r*r+o*o)),"dpad"===a&&l<n.deadzone||h<l?d(a,t)&&A.preventDefault:function(s,i){if("dpad"==s){m.inputs[s].touch=i.identifier;let A=0;for(var[a,n]of Object.entries(m.dirval))m.ui[a]&&(A+=n);m.ui.up=!1,m.ui.down=!1,m.ui.left=!1,m.ui.right=!1;let e=[];var r=Math.atan2(i.clientY-m.inputs.dpad.y,i.clientX-m.inputs.dpad.x)*m.rad2deg;-150<=r&&r<=-30?e.push("up"):r<=150&&30<=r&&e.push("down"),-60<=r&&r<=60?e.push("right"):(120<=r||r<=-120)&&e.push("left");let t=0;if(e.forEach(A=>{m.ui[A]=!0,t+=m.dirval[A]}),t===A)return;m.dPadHighlight.style.display="block",m.dPadHighlight.setAttribute("class",e.join("-"))}else{if(m.inputs[s].touch===i.identifier)return;m.inputs[s].touch=i.identifier;i=s.toLowerCase()+"Button";m[i].style.display="block",m.ui[s]=!0}return m.onInputChanged.call(m.onInputChangedThisArg,m.ui),1}(a,t)&&A.preventDefault}}}this.viewport=document.getElementById("viewport"),this.fader=document.getElementById("fader"),this.loadingSkin=document.getElementById("loading-skin"),this.loaderBar=document.getElementById("loader-bar"),this.gameplaySkin=document.getElementById("gameplay-skin"),this.uiElements=document.getElementById("ui-elements"),this.screenframe=document.getElementById("screenframe"),this.screen=document.getElementById("screen"),this.screenTransition=document.getElementById("screenTransition"),this.led=document.getElementById("led"),this.dPadFrame=document.getElementById("dpad-frame"),this.dPad=document.getElementById("dpad"),this.dPadHighlight=document.getElementById("dpad-highlight"),this.AbButtonsFrame=document.getElementById("ab-buttons-frame"),this.AbButtons=document.getElementById("ab-buttons"),this.aButton=document.getElementById("a-button"),this.bButton=document.getElementById("b-button"),this.startSelectButtonsFrame=document.getElementById("start-select-buttons-frame"),this.startSelectButtons=document.getElementById("start-select-buttons"),this.startButton=document.getElementById("start-button"),this.selectButton=document.getElementById("select-button"),this.speakerFrame=document.getElementById("speaker-frame"),this.speaker=document.getElementById("speaker"),this.character=document.getElementById("character"),this.logo=document.getElementById("logo"),this.screenHint=document.getElementById("screenHint"),this.hintText=document.getElementById("hintText"),this.hintShadow=document.getElementById("hintShadow"),this.gameTimer=document.getElementById("gameTimer"),this.gameTimeOver=document.getElementById("gameTimeOver"),this.rad2deg=180/Math.PI,this.dirval={up:1,down:2,left:4,right:8},this.ui={up:!1,right:!1,down:!1,left:!1,A:!1,B:!1,select:!1,start:!1},this.inputs={dpad:{x:0,y:0,size:0,touch:!1,deadzone:0},A:{x:0,y:0,size:0,touch:!1},B:{x:0,y:0,size:0,touch:!1},select:{x:0,y:0,size:0,touch:!1},start:{x:0,y:0,size:0,touch:!1}},window.addEventListener("resize",()=>{setTimeout(()=>{GameWrapper.updateGameScreenOrientation()},500)}),document.body.onclick=function(A){A.preventDefault()},document.ontouchstart=e,document.ontouchmove=e,document.ontouchend=e,document.ontouchcancel=e,this.onScreenUpdated=void 0!==A.onScreenUpdated?A.onScreenUpdated:function(A){},this.onScreenUpdatedThisArg=void 0!==A.onScreenUpdatedThisArg?A.onScreenUpdatedThisArg:this,this.onInputChanged=void 0!==A.onInputChanged?A.onInputChanged:function(A,e){},this.onInputChangedThisArg=void 0!==A.onInputChangedThisArg?A.onInputChangedThisArg:this,this.updateGameScreenOrientation()},resetGameElements:function(){document.body.setAttribute("class",""),this.uiElements.setAttribute("style",""),this.screenframe.setAttribute("style",""),this.gameplaySkin.setAttribute("class","gameplay-skin"),this.screen.setAttribute("style",""),this.led.setAttribute("style",""),this.dPadFrame.setAttribute("style",""),this.dPad.setAttribute("style",""),this.dPadHighlight.setAttribute("style","display:none"),this.AbButtonsFrame.setAttribute("style",""),this.AbButtons.setAttribute("style",""),this.aButton.setAttribute("style","display:none"),this.bButton.setAttribute("style","display:none"),this.startSelectButtonsFrame.setAttribute("style",""),this.startSelectButtons.setAttribute("style",""),this.startButton.setAttribute("style","display:none"),this.selectButton.setAttribute("style","display:none"),this.speakerFrame.setAttribute("style",""),this.speaker.setAttribute("style","")},viewGameMobileLandscape:function(A){this.resetGameElements(A);var e=this.layoutGBA,t=A.ew/e.baseWidth,s=A.eh/e.baseHeight,i=t<s?t:s;1.3<=i?document.body.setAttribute("class","zoom-1-3"):i<=.7?document.body.setAttribute("class","zoom-0-5"):i<=.9&&document.body.setAttribute("class","zoom-0-8");var a=2*Math.round(e.baseWidth*i/2),n=2*Math.round(e.baseHeight*i/2),r=(A.ew-a)/2,o=(A.eh-n)/2;this.gameplaySkin.style.width=a+"px",this.gameplaySkin.style.height=n+"px",this.gameplaySkin.style.top=o+"px",this.gameplaySkin.style.left=r+"px";var h=Math.ceil(e.screenFrameWidth*i),l=Math.ceil(e.screenFrameHeight*i),m=Math.round((a-h)/2),d=Math.round((n-l)*(e.screenFrameTop/(e.baseHeight-e.screenFrameHeight)));this.screenframe.style.width=h+"px",this.screenframe.style.height=l+"px",this.screenframe.style.top=d+"px",this.screenframe.style.left=m+"px";let c={size:2*Math.round(e.screenSize*i/2)};c.top=o+Math.round(e.screenTop*i),c.left=Math.round((A.ew-c.size)/2),this.screen.style.width=this.screen.style.height=c.size+"px",this.screen.style.top=c.top+"px",this.screen.style.left=c.left+"px";var u=Math.round(e.inputTop*i),p=Math.round(e.topInputHeight*i),g=Math.round(e.bottomInputHeight*i),y=Math.round(e.inputWidth*i),f=Math.round(e.dPadSize*i),S=Math.round(e.inputMarginX*i),T=Math.round(e.smallButtonWidth*i),b=Math.round(e.smallButtonHeight*i),w=Math.round(e.smallButtonSize*i),M=Math.round(e.smallButtonLeft*i),B=Math.round(e.mainButtonSize*i),v=Math.round(e.mainButtonMargin*i),t=Math.round(e.startButtonTop*i),s=Math.round(e.selectButtonTop*i),a=Math.round(e.AbButtonWidth*i),n=Math.round(e.AbButtonHeight*i),l=Math.round(e.ledTop*i),d=Math.round(e.ledSize*i);this.dPadFrame.style.width=this.AbButtonsFrame.style.width=this.startSelectButtonsFrame.style.width=this.speakerFrame.style.width=y+"px",this.dPadFrame.style.height=this.AbButtonsFrame.style.height=p+"px",this.startSelectButtonsFrame.style.height=this.speakerFrame.style.height=g+"px",this.dPadFrame.style.top=this.AbButtonsFrame.style.top=u+"px",this.startSelectButtonsFrame.style.top=this.speakerFrame.style.top=u+p+"px",this.dPadFrame.style.left=this.startSelectButtonsFrame.style.left=S+"px",this.AbButtonsFrame.style.right=this.speakerFrame.style.right=S+"px",this.dPad.style.width=this.dPad.style.height=f+"px",this.led.style.width=this.led.style.height=d+"px",this.led.style.left=m+h+"px",this.led.style.top=l+"px",this.AbButtons.style.width=a+"px",this.AbButtons.style.height=n+"px",this.aButton.style.width=this.aButton.style.height=this.bButton.style.width=this.bButton.style.height=B+"px",this.aButton.style.top=this.aButton.style.right=this.bButton.style.bottom=this.bButton.style.left=v+"px",this.startSelectButtons.style.width=T+"px",this.startSelectButtons.style.height=b+"px",this.startButton.style.width=this.startButton.style.height=this.selectButton.style.width=this.selectButton.style.height=w+"px",this.startButton.style.left=this.selectButton.style.left=M+"px",this.startButton.style.top=t+"px",this.selectButton.style.top=s+"px",this.speaker.style.width=Math.round(e.speakerWidth*i)+"px",this.speaker.style.height=Math.round(e.speakerHeight*i)+"px",this.inputs.dpad.x=S+y/2+r,this.inputs.dpad.y=u+p/2+o,this.inputs.dpad.size=f,this.inputs.dpad.deadzone=Math.floor(e.dPadDeadzone*i),this.inputs.start.x=S+M+(w+y-T)/2+r,this.inputs.start.y=u+p+t+(w+g-b)/2+o,this.inputs.start.size=w,this.inputs.select.x=S+M+(w+y-T)/2+r,this.inputs.select.y=u+p+s+(w+g-b)/2+o,this.inputs.select.size=w,this.inputs.A.x=A.ew-S-(B+y-a)/2-r,this.inputs.A.y=u+(B+p-n)/2+o,this.inputs.A.size=B,this.inputs.B.x=A.ew-S-y+(B+y-a)/2-r,this.inputs.B.y=u+p-(B+p-n)/2+o,this.inputs.B.size=B,this.onScreenUpdated.call(this.onScreenUpdatedThisArg,c),this.updateGameTimerElement(c.size)},viewGameMobilePortrait:function(A){this.resetGameElements(A);var e=this.layoutGBC,t=A.ew/e.baseWidth,s=A.eh/e.baseHeight,i=t<s?t:s;1.3<=i?document.body.setAttribute("class","zoom-1-3"):i<=.7?document.body.setAttribute("class","zoom-0-5"):i<=.9&&document.body.setAttribute("class","zoom-0-8");var a=2*Math.round(e.baseWidth*i/2),n=2*Math.round(e.baseHeight*i/2),r=(A.ew-a)/2,o=(A.eh-n)/2;this.gameplaySkin.style.width=a+"px",this.gameplaySkin.style.height=n+"px",this.gameplaySkin.style.top=o+"px",this.gameplaySkin.style.left=r+"px";var h=Math.ceil(e.screenFrameWidth*i),l=Math.ceil(e.screenFrameHeight*i),m=Math.round((a-h)/2),d=Math.round((n-l)*(e.screenFrameTop/(e.baseHeight-e.screenFrameHeight)));this.screenframe.style.width=h+"px",this.screenframe.style.height=l+"px",this.screenframe.style.top=d+"px",this.screenframe.style.left=m+"px";let c={size:2*Math.round(e.screenSize*i/2)};c.top=o+Math.round(e.screenTop*i),c.left=Math.round((A.ew-c.size)/2),this.screen.style.width=this.screen.style.height=c.size+"px",this.screen.style.top=c.top+"px",this.screen.style.left=c.left+"px";var u=Math.round(e.mainButtonFrameTop*i),p=Math.round(e.mainButtonFrameHeight*i),g=Math.round(e.mainButtonMargin*i),y=Math.round(e.mainButtonSize*i),f=(Math.round(e.smallButtonTop*i),Math.round(e.inputMarginX*i)),S=Math.round(e.dPadSize*i),t=(Math.round(e.dPadDeadzone*i),Math.round(e.AbButtonWidth*i)),s=Math.round(e.AbButtonHeight*i),a=Math.round(e.smallButtonFrameTop*i),n=Math.round(e.smallButtonWidth*i),h=Math.round(e.smallButtonHeight*i),l=Math.round(e.smallButtonSize*i),d=Math.round(e.speakerWidth*i),m=Math.round(e.speakerHeight*i);this.dPadFrame.style.top=this.AbButtonsFrame.style.top=u+"px",this.dPadFrame.style.height=this.AbButtonsFrame.style.height=p+"px",this.dPadFrame.style.left=f+"px",this.AbButtonsFrame.style.right=f+"px",this.dPad.style.width=this.dPad.style.height=S+"px",this.AbButtons.style.width=t+"px",this.AbButtons.style.height=s+"px",this.startSelectButtonsFrame.style.top=this.speakerFrame.style.top=a+"px",this.startSelectButtons.style.width=n+"px",this.startSelectButtons.style.height=h+"px",this.startButton.style.top=this.selectButton.style.top=(h-l)/2+"px",this.startButton.style.width=this.startButton.style.height=this.selectButton.style.width=this.selectButton.style.height=l+"px",this.startButton.style.right=this.selectButton.style.left="0px",this.speaker.style.width=d+"px",this.speaker.style.height=m+"px",this.speaker.style.right=f+"px",this.inputs.dpad.x=f+S/2+r,this.inputs.dpad.y=u+p/2+o,this.inputs.dpad.size=S,this.inputs.dpad.deadzone=Math.floor(e.dPadDeadzone*i),this.inputs.select.x=(A.ew-n+l)/2,this.inputs.select.y=a+h/2+o,this.inputs.select.size=l,this.inputs.start.x=(A.ew+n-l)/2,this.inputs.start.y=a+h/2+o,this.inputs.start.size=l,this.inputs.A.x=A.ew-f-g-y/2-r,this.inputs.A.y=u+g+(p-s+y)/2+o,this.inputs.A.size=y,this.inputs.B.x=A.ew-f-t+g+y/2-r,this.inputs.B.y=u+p-g-(p-s+y)/2+o,this.inputs.B.size=y,this.aButton.style.width=this.aButton.style.height=this.bButton.style.width=this.bButton.style.height=y+"px",this.aButton.style.top=this.aButton.style.right=this.bButton.style.bottom=this.bButton.style.left=g+"px",this.onScreenUpdated.call(this.onScreenUpdatedThisArg,c),this.updateGameTimerElement(c.size)},viewGameDesktop:function(A){this.resetGameElements(A);var e=this.layoutDesktop,t=A.ew/e.baseWidth,s=A.eh/e.baseHeight,i=t<s?t:s,a=2*Math.round(e.baseWidth*i/2),n=2*Math.round(e.baseHeight*i/2),t=(A.ew-a)/2,s=(A.eh-n)/2;this.gameplaySkin.style.width=a+"px",this.gameplaySkin.style.height=n+"px",this.gameplaySkin.style.top=s+"px",this.gameplaySkin.style.left=t+"px";let r={size:2*Math.round(e.screenSize*i/2)};r.top=s+Math.round(e.screenTop*i),r.left=Math.round((A.ew-r.size)/2),this.screen.style.width=this.screen.style.height=r.size+"px",this.screen.style.top=r.top+"px",this.screen.style.left=r.left+"px";t=Math.round(e.characterWidth*i),s=Math.round(e.characterHeight*i),A=t/e.characterFrameWidth;this.character.style.width=t+"px",this.character.style.height=s+"px",this.character.style.position="absolute",this.character.style.bottom=Math.round(32*i)+"px",this.character.style.right=Math.round(32*i)+"px";s=Math.round(e.logoWidth*A),e=Math.round(e.logoHeight*A);this.logo.style.width=s+"px",this.logo.style.height=e+"px",this.logo.style.position="absolute",this.logo.style.top=Math.round(32*i)+"px",this.logo.style.left=Math.round(32*i)+"px",this.onScreenUpdated.call(this.onScreenUpdatedThisArg,r),this.updateGameTimerElement(r.size),this.setCharacterScale(A),this.setLogoScale(A)},updateGameTimerElement(A=0){let e=1048,t=160,s=240,i=240;A/=e;this.gameTimerWidth=Math.floor(e*A),this.gameTimerHeight=Math.floor(t*A),this.gameTimer.style.width=this.gameTimerWidth+"px",this.gameTimer.style.height=this.gameTimerHeight+"px",this.gameTimeOver.style.width=Math.floor(s*A)+"px",this.gameTimeOver.style.height=Math.floor(i*A)+"px",this.gameTimer.style.backgroundSize=this.gameTimerWidth+"px "+this.gameTimerHeight*this.gameTimerFrames+"px",this.updateGameTimerFrame()},startGameTimerFlicker(){let A=this;this.gameTimerInterval||(this.gameTimerInterval=setInterval(()=>{A.gameTimerFlickerFrame++,A.gameTimerFlickerFrame>=A.gameTimerFlickerFrames&&(A.gameTimerFlickerFrame=0),A.updateGameTimerFrame()},100))},startGameTimer(){this.startGameTimerFlicker(),this.gameTimerStep=0,this.gameTimer.style.display="",this.gameTimeOver.style.display="none"},stopGameTimer(){let A=this;this.stopGameTimerFlicker(),this.gameTimer.style.display="none",this.gameTimeOver.style.display="",setTimeout(()=>{A.gameTimeOver.style.display="none"},500)},stopGameTimerFlicker(){this.gameTimerInterval&&clearInterval(this.gameTimerInterval),this.gameTimerInterval=null},updateGameTimerFrame(){frame=this.gameTimerStep*this.gameTimerFlickerFrames+this.gameTimerFlickerFrame,this.gameTimer.style.backgroundPosition="0px -"+this.gameTimerHeight*frame+"px"},showLoadScreen(){this.loadingSkin.style.display=""},setLoadedValue(A){this.loaderBar.style.width=Math.round(100*A)+"%"},hideLoadScreen(){this.loadingSkin.style.display="none"},fadeIn(){this.fader.style.opacity="0"},fadeOut(){this.fader.style.opacity="1"},crossFade(A,e){this.fadeOut(),setTimeout(()=>{this.fadeIn(),A&&A(),e&&setTimeout(()=>{e()},500)},500)},setHintText:function(A){this.hintText.innerHTML=this.hintShadow.innerHTML="",this.screenHint.style.fontSize="",this.screenHint.style.display="",this.screenHint.style.transition="",this.screenHint.style.transitionTimingFunction="";let e=Math.floor(this.screenHint.offsetHeight);this.screenHint.style.fontSize=e+"px",this.hintText.textContent=this.hintShadow.textContent=A,this.screenHint.style.top="-"+2*e+"px";let t=this;setTimeout(()=>{t.screenHint.style.transition="0.2s",t.screenHint.style.transitionTimingFunction="ease-out",t.screenHint.style.top=""},1),setTimeout(()=>{t.screenHint.style.transition="0.2s",t.screenHint.style.transitionTimingFunction="ease-in",t.screenHint.style.top="-"+2*e+"px",GameWrapper.characterAnimation=1},800)},transitionImage:new Image,transitionSize:524,transitionZoom:1,transitionFrame:1,transitionFramerates:{a:8,b:8},exitTransition:function(A,e,t){if(!A)throw"Missing required callback";this.screenTransition.style.display="";let s=((e=e||2)-1)/((t=t||250)/(1e3/60)),i=this;i.setTransitionZoom(1,5);let a=setInterval(function(){i.transitionZoom>=e?(clearInterval(a),A()):i.setTransitionZoom(i.transitionZoom+s,5)},1e3/60)},enterTransition:function(A,e,t){if(!A)throw"Missing required callback";this.screenTransition.style.display="";let s=((e=e||2)-1)/((t=t||250)/(1e3/60)),i=this;i.setTransitionZoom(e,5);let a=setInterval(function(){1===e?(clearInterval(a),A()):((e-=s)<1&&(e=1),i.setTransitionZoom(e,5))},1e3/60)},playTransitionIdle:function(A,e,t){if(!A)throw"Missing required callback";this.screenTransition.style.display="",t=t||1500,e=e||8;let s=this,i=setInterval(function(){s.setTransitionFrame(1===s.transitionFrame?2:1)},1e3/e);setTimeout(function(){clearInterval(i),A()},t)},playTransitionOpen:function(A,e,t){if(!A)throw"Missing required callback";this.screenTransition.style.display="",t=t||500,e=e||15;let s=this;this.setTransitionFrame(3);let i=setInterval(function(){s.setTransitionFrame(s.transitionFrame+1),4<s.transitionFrame&&clearInterval(i)},1e3/e);setTimeout(function(){clearInterval(i),A()},t)},playTransitionClose:function(A,e,t){if(!A)throw"Missing required callback";this.screenTransition.style.display="",e=e||15;let s=this;this.setTransitionFrame(5);let i=setInterval(function(){s.setTransitionFrame(s.transitionFrame-1),s.transitionFrame<3&&(clearInterval(i),A())},1e3/e)},setTransitionImage:function(A){if(!A.src||!A.naturalHeight)throw"Image not loaded!";this.transitionImage=A,this.screenTransition.style.background='url("'+this.transitionImage.src+'")',this.screenTransition.style.backgroundColor="rgba(0,0,0,0.01)",this.setTransitionZoom(1)},setTransitionZoom(A,e){if(!this.transitionImage.src||!this.transitionImage.naturalHeight)throw"Image not loaded!";this.transitionZoom=A,this.transitionSize=Math.ceil(this.screenTransition.offsetHeight*A);var t=5*this.transitionSize,A=this.transitionSize;this.screenTransition.style.backgroundSize=t+"px "+A+"px",this.setTransitionFrame(void 0!==e?e:null)},setTransitionFrame:function(A){if(!this.transitionImage.src||!this.transitionImage.naturalHeight)throw"Image not loaded!";if((A=null===A?1:A)<1||5<A)throw"Frame must be a number between 1 and 5";this.transitionFrame=A;var e=(this.screenTransition.offsetHeight-this.transitionSize)/2,A=-((this.transitionFrame-1)*this.transitionSize-e);this.screenTransition.style.backgroundPosition="top "+e+"px left "+A+"px"},endTransition:function(){this.screenTransition.style.display="none"},characterImage:new Image,characterAnimation:1,characterFrame:0,characterInterval:null,characterScale:1,characterSteps:12,characterSize:{x:160,y:290},setCharacterImage:function(A){if(!BrowserHelper.isMobile()){if(!A.src||!A.naturalHeight)throw"Image not loaded!";this.characterImage=A,this.character.style.backgroundImage='url("'+this.characterImage.src+'")',this.startCharacterAnimation()}},startCharacterAnimation:function(){if(!BrowserHelper.isMobile()){let A=this;this.stopCharacterAnimation(),this.characterInterval=setInterval(function(){A.characterFrame++,2<A.characterFrame&&(A.characterFrame=1),A.updateCharacterAnimation()},Math.round(PWGame.msPerTargetFrame*this.characterSteps)),this.updateCharacterAnimation()}},stopCharacterAnimation:function(){BrowserHelper.isMobile()||this.characterInterval&&clearInterval(this.characterInterval)},setCharacterScale:function(A){var e;BrowserHelper.isMobile()||(e=this.layoutDesktop,this.characterSize.x=Math.round(e.characterFrameWidth*A),this.characterSize.y=Math.round(e.characterFrameHeight*A),this.character.style.backgroundSize=3*this.characterSize.x+"px "+2*this.characterSize.y+"px",this.characterScale=A)},updateCharacterAnimation:function(){var A=(this.characterFrame-1)*this.characterSize.y,e=(this.characterAnimation-1)*this.characterSize.x;this.character.style.backgroundPosition="-"+e+"px -"+A+"px"},logoImage:new Image,logoScale:1,logoSize:{x:320,y:180},setLogoImage:function(A){if(!BrowserHelper.isMobile()){if(!A.src||!A.naturalHeight)throw"Image not loaded!";this.logoImage=A,this.logo.style.backgroundImage='url("'+this.logoImage.src+'")'}},setLogoScale:function(A){var e;BrowserHelper.isMobile()||(e=this.layoutDesktop,this.logoSize.x=Math.round(e.logoWidth*A),this.logoSize.y=Math.round(e.logoHeight*A),this.logo.style.backgroundSize=this.logoSize.x+"px "+this.logoSize.y+"px",this.logoScale=A)},getWindowSize:function(){var A={orientation:"desktop"};let e=document.createElement("div");return e.style.cssText="position:fixed;width:100%;height:100%;top:0px;left:0px",document.body.appendChild(e),BrowserHelper.isMobile()&&(A.orientation=e.clientWidth>e.clientHeight?"landscape":"portrait"),window.screen.width>window.screen.height&&"portrait"==A.orientation||window.screen.width<window.screen.height&&"landscape"==A.orientation?(A.width=window.screen.height,A.height=window.screen.width):(A.width=window.screen.width,A.height=window.screen.height),A.ew=e.clientWidth,A.eh=e.clientHeight,e.parentNode.removeChild(e),A},updateGameScreenOrientation:function(){var A=GameWrapper.getWindowSize();"game"===this.view&&("landscape"===A.orientation?GameWrapper.viewGameMobileLandscape(A):"portrait"===A.orientation?GameWrapper.viewGameMobilePortrait(A):GameWrapper.viewGameDesktop(A),this.gameplaySkin.setAttribute("class","gameplay-skin "+A.orientation))}};class PWInput{constructor(){let s=this;this.reset(),this.keyMap_arrows={up:"ArrowUp",right:"ArrowRight",down:"ArrowDown",left:"ArrowLeft",B:"KeyS",A:"KeyA",select:"KeyZ",start:"KeyX"},this.keyMap_wasd={up:"KeyW",right:"KeyD",down:"KeyS",left:"KeyA",B:"KeyO",A:"KeyP",select:"KeyK",start:"KeyL"},this.setKeyMap("arrows"),document.addEventListener("keydown",function(A){for(var[e,t]of Object.entries(s.keyMap))if(A.code==t){s.setInputState(e,!0,A);break}}),document.addEventListener("keyup",function(A){for(var[e,t]of Object.entries(s.keyMap))if(A.code==t){s.setInputState(e,!1,A);break}})}setKeyMap(A){this.keyMap={};for(var[e,t]of Object.entries(this["keyMap_"+A]))this.mapKey(t,e)}mapKey(A,e){this.keyMap[e]=A}reset(){this.inputs={up:!1,right:!1,down:!1,left:!1,B:!1,A:!1,select:!1,start:!1},this._onPress={},this._onPressThisArg={},this._onRelease={},this._onReleaseThisArg={},this._aliases={},this._alias_map={}}setAlias(e,A){let t=this;(A="string"==typeof A?[A]:A).forEach(A=>{t._aliases[A]||(t._aliases[A]=[]),t._aliases[A].indexOf(e)<0&&t._aliases[A].push(e)}),this._alias_map[e]=A,console.log(this._aliases)}isDown(A){if(this._alias_map[A]){for(var e in this._alias_map[A])if(this.inputs[this._alias_map[A][e]])return!0;return!1}return void 0!==this.inputs[A]&&this.inputs[A]}onPress(A,e,t){this._onPressThisArg[A]=void 0!==t?t:this,this._onPress[A]=e}onRelease(A,e,t){this._onReleaseThisArg[A]=void 0!==t?t:this,this._onRelease[A]=e}setInputState(A,t,s){if(this.checkInputState(A,t,s),this._aliases[A]){let e=this;this._aliases[A].forEach(function(A){e.checkInputState(A,t,s)})}}checkInputState(A,e,t){this.inputs[A]!==e&&((this.inputs[A]=e)&&this._onPress[A]?this._onPress[A].call(this._onPressThisArg[A],A,t):!e&&this._onRelease[A]&&this._onRelease[A].call(this._onReleaseThisArg[A],A,t))}onLayoutInputChanged(A){var e,t;for([e,t]of Object.entries(A))t!==this.inputs[e]&&this.setInputState(e,t,null)}}PWInput.PLAYMODE_GAMEPAD="gamepad",PWInput.PLAYMODE_TOUCH="touch";class PWFramework{static USERMODE_PROD="prod";static USERMODE_DEBUG="debug";static USERMODE_DEV="dev";phaser=null;constructor(){this.usermode="prod",this.screensize=524,this.screen=null,this.paused=!1,this.in_transition=!1,this.targetFPS=60,this.gameSpeed=PWConfig.SPEED_NORMAL,this.msPerTargetFrame=null,this.msPerStep=null,this.stepTracker=null,this.input=new PWInput,this.winOnTimeUp=!1,this.onManifestsLoaded=()=>{},this.setGameSpeed(this.gameSpeed)}start(A="prod"){if(-1===[PWFramework.USERMODE_PROD,PWFramework.USERMODE_DEBUG,PWFramework.USERMODE_DEV].indexOf(A))throw"Invalid usermode: "+A;this.usermode=A;let e=this;GameWrapper.init({onScreenUpdated:this.onScreenUpdated,onScreenUpdatedThisArg:this,onInputChanged:this.input.onLayoutInputChanged,onInputChangedThisArg:this.input}),this.phaser=new Phaser.Game({parent:"screen",type:Phaser.AUTO,width:this.screensize,height:this.screensize,id:"PhaserCanvas",backgroundColor:"#000000",scene:{create:function(){e.phaser.scene.add("PWGameSceneloader",new PWGameSceneloader),e.usermode===PWFramework.USERMODE_DEV?e.startDevScreen():alert("This mode isn't supported yet!")}}})}onScreenUpdated(A){this.screen=A,this.phaser&&this.phaser.canvas&&(this.phaser.canvas.style.width=A.size+"px",this.phaser.canvas.style.height=A.size+"px")}startDevScreen(){let t=this,s=document.getElementById("dev-interface"),i=document.getElementById("microgame-team"),a=document.getElementById("microgame-dir"),A=document.getElementById("microgame-btn");s.style.display="",this.phaser.canvas.style.display="none",GameWrapper.gameplaySkin.style.display="none",GameWrapper.fadeIn(),A.onclick=function(A){A.preventDefault(),A.stopPropagation();var e="teams/"+i.value+"/microgames/"+a.value;if(e=4!==(A=(A=e).split("/")).length?(console.error("Invalid path!",A),!1):[A[1],A[3]]){let A={microgames:[e],gamesPerRound:1,devMode:"game"};s.style.pointerEvents="none",GameWrapper.crossFade(function(){s.style.display="none",s.style.pointerEvents="",t.startLevel(A)})}}}startLevel(A){console.log("Starting level",A),this.in_transition=!0;let e=this;this.level=new PWLevel(A),this.showGameLayout(),GameWrapper.showLoadScreen(),GameWrapper.setLoadedValue(0),this.level.preload(function(A){GameWrapper.setLoadedValue(A),1===A&&GameWrapper.crossFade(()=>{GameWrapper.hideLoadScreen(),GameWrapper.setTransitionImage(e.level.imgs.transsheet),GameWrapper.setCharacterImage(e.level.imgs.charsheet),GameWrapper.setLogoImage(e.level.imgs.logo),e.level.hasIntro()?e.level.playIntro(function(){e.nextPhase()}):e.nextPhase()})},!0),this.level.onGameComplete(function(){e.nextPhase(!0)})}showGameLayout(){GameWrapper.updateGameScreenOrientation(),GameWrapper.gameplaySkin.style.display="",this.phaser.canvas.style.display=""}nextPhase(a){let n=this;this.level.getNext(function(A,e){let t=null,s=null;switch(n.in_transition=!0,A){case"microgame":t=e;break;case"newround":var i;"bossgame"===e?s="Boss Level!":(s="Faster!",i=[null,PWConfig.SPEED_NORMAL,PWConfig.SPEED_FASTER,PWConfig.SPEED_FASTEST],n.setGameSpeed(i[n.level.round]));break;case"finish":s="devmode"===e?"Test Complete!":"You Win!"}t?a?GameWrapper.enterTransition(function(){GameWrapper.playTransitionClose(function(){n.nextGame(t)})}):n.nextGame(t):s&&GameWrapper.enterTransition(function(){GameWrapper.setHintText(s),GameWrapper.playTransitionClose(function(){"finish"===A?GameWrapper.playTransitionIdle(function(){GameWrapper.crossFade(function(){GameWrapper.stopCharacterAnimation(),"devmode"===e&&n.startDevScreen()})}):n.nextPhase(!1)})})})}nextGame(A){let e=this;GameWrapper.playTransitionIdle(function(){e.startActualGame(A),GameWrapper.setHintText(A.hint),GameWrapper.playTransitionOpen(function(){GameWrapper.exitTransition(function(){e.in_transition=!1,GameWrapper.endTransition(),e.msPerStep=e.msPerTargetFrame*PWConfig.FRAMES_PER_STEP,e.stepTracker=0,GameWrapper.startCharacterAnimation(),GameWrapper.startGameTimer()})})})}startActualGame(A){this.input.reset(),this.phaser.scene.start(A.sceneClass)}loadMicroGame(A,a,n,e){let r=this;!0===n&&(e=!0,n=function(){}),n=void 0!==n?n:function(A){alert(A)},this.loadMicroGameManifest(A,function(s,i){let e=[];if(["name","jsFiles","sceneClass","input","hint"].forEach(function(A){void 0===s[A]&&e.push("Missing required property in manifest.json: '"+A+"'")}),0<e.length)n(e.join("\n"));else{let t;try{t=r.getSceneClass(s.sceneClass)}catch(A){t=null}if(t)r.registerScene(t,s),r.preloadManifests([s],()=>{a(s)});else{let e=s.jsFiles.length;s.jsFiles.forEach(A=>{loaderScript(i+A).then(()=>{if(e--,e<=0)try{t=r.getSceneClass(s.sceneClass),r.registerScene(t,s),r.preloadManifests([s],()=>{a(s)})}catch(A){n(A)}}).catch(A=>{console.error(A),n(A)})})}}},n,e)}preloadManifests(A,e){this.onManifestsLoaded=void 0!==e?e:function(){},A.forEach(A=>{PWGameSceneloader.manifests.push(A)}),this.phaser.scene.start("PWGameSceneloader")}loadMicroGameManifest(e,t,s,A){_Manifests.microgames[e[0]]=void 0!==_Manifests.microgames[e[0]]?_Manifests.microgames[e[0]]:{},!0===s&&(A=!0,s=function(){}),s=void 0!==s?s:function(A){alert(A)};let i="teams/"+e[0]+"/microgames/"+e[1]+"/";A||!_Manifests.microgames[e[0]][e[1]]?this.getJSON(i+"manifest.json",function(A){A.path=i,_Manifests.microgames[e[0]][e[1]]=A,t(_Manifests.microgames[e[0]][e[1]],i)},function(A){console.error(A),console.error("Couldn't find file: "+i+"/manifest.json"),s("Could not load game at "+e[0]+"/"+e[1])}):(_Manifests.microgames[e[0]][e[1]].path=i,t(_Manifests.microgames[e[0]][e[1]],i))}getJSON(A,e,t,s){"function"==typeof e&&(s=t,t=e,e=null),t=void 0!==t?t:function(){},s=void 0!==s?s:function(A){console.error(A),alert(A)},this.get(A,e,function(A){try{var e=JSON.parse(A);t(e)}catch(A){s(A)}},s)}get(A,e,t,s){if("function"==typeof e&&(s=t,t=e,e=null),t="function"==typeof t?t:function(){},s=void 0!==s?s:function(A){console.error(A),alert(A)},e&&"object"==typeof e){let A=[];for(var[i,a]of Object.entries(e))A.push(encodeURIComponent(i)+"="+encodeURIComponent(a));e="?"+A.join("&")}else e="";var n=new XMLHttpRequest;n.onreadystatechange=function(){4==this.readyState&&(200==this.status?t(this.responseText):s(this.responseText,this.status))},n.open("GET",A+e,!0),n.send()}registerScene(A,e){PWGameSceneloader.loaded[e.sceneClass]||(PWGameSceneloader.loaded[e.sceneClass]=A,this.phaser.scene.add(e.sceneClass,new A))}getSceneClass(A){let e=null,t=[],s=A.split(".");var i=s.shift();if("microgames"===i)e=microgames;else{if("bossgames"!==i)throw"Scene class must be namespaced to microgames or bossgames!";e=bossgames}for(t.push(i);0<s.length;){var a=s.shift();if(t.push(a),e=void 0!==e[a]?e[a]:null,!e)throw t.join(".")+" is undefined."}if(e.prototype instanceof Phaser.Scene)return e;throw A+" is either not an extension of Phaser.Scene, or there are errors in the class file."}isReady(){return!this.in_transition&&!this.paused}togglePause(){return this.paused?this.resume():this.pause(),this.paused}pause(){this.paused=!0,this.phaser.pause()}resume(){this.paused=!1,this.phaser.resume()}setGameSpeed(A){this.gameSpeed=A,this.msPerTargetFrame=1e3/(this.targetFPS*A)}getDeltaMultiplier(A){return GameWrapper.gameTimerStep<GameWrapper.gameTimerSteps+1&&(this.stepTracker+=A,this.stepTracker>=this.msPerStep&&(this.stepTracker-=this.msPerStep,GameWrapper.gameTimerStep++,GameWrapper.gameTimerStep===GameWrapper.gameTimerSteps?(console.log("Time Up!",GameWrapper.gameTimerStep),GameWrapper.stopGameTimer()):GameWrapper.gameTimerStep>GameWrapper.gameTimerSteps?(console.log("Game over!",GameWrapper.gameTimerStep),this.level.gameCompleted(this.winOnTimeUp)):GameWrapper.updateGameTimerFrame())),A/this.msPerTargetFrame}lostGame(A=!1){!0===A&&(GameWrapper.characterAnimation=3),this.winOnTimeUp=!1}wonGame(A=!1){!0===A&&(GameWrapper.characterAnimation=2),this.winOnTimeUp=!0}}const microgames={},bossgames={},PWConfig={SPEED_NORMAL:1,SPEED_FASTER:1.25,SPEED_FASTEST:1.5,FRAMES_PER_STEP:20},PWGame=new PWFramework;class PWCharacter{}class PWLevel{constructor(A){if(!A)throw"Missing required manifest!";if(this.devMode=!1,A.devMode){this.devMode=A.devMode;for(var[e,t]of Object.entries(PWLevel.default_manifest))void 0===A[e]&&(A[e]=t)}if(!A.character)throw"Missing required character!";if(!A.logo)throw"Missing required logo!";if(!A.transition)throw"Missing required transition!";if(!A.microgames&&"bossgame"!==A.devMode)throw"Missing required microgame array!";if(!A.bossgame&&"game"!==A.devMode)throw"Missing required bossgame!";this.round=1,this.gamesPerRound=void 0!==A.gamesPerRound?A.gamesPerRound:5,this.currentGame=0,this.gamesRemaining=this.gamesPerRound,this.microgame_manifests=[],this.microgame_manifests_used=[],this.manifest=A,this.imgs={logo:new Image,character:new Image,transition:new Image}}getNext(A){if(this.round<4)if(this.manifest.microgames&&0!==this.manifest.microgames.length){if(!(0<this.gamesRemaining))return this.round++,this.gamesRemaining=this.gamesPerRound,console.log("newround!!!"),void(this.round<4?A("newround","microgame"):"game"===this.manifest.devMode?A("finish","devmode"):A("newround","bossgame"));console.log("next micro!"),this.gamesRemaining--}else{if("bossgame"!==this.manifest.devMode)return console.error("No microgames!"),void A("error","No microgames!");console.log("skipping microgames"),this.round=4}this.round<4?(console.log("start micro!"),A("microgame",this.getRandomMicrogameManifest())):4===this.round&&(this.manifest.bossgame?(console.log("start boss!"),A("bossgame",this.getBossgameManifest())):"game"===this.manifest.devMode?(console.log("skip bossgame"),this.round=5,A("finish",null)):(console.error("No bossgame!"),A("error","No bossgame!")))}onGameComplete(A){this.game_complete_callback=A}gameCompleted(A){GameWrapper.characterAnimation=A?2:3,this.game_complete_callback&&this.game_complete_callback(A)}preload(A,s){let i=this;var e=3;this.manifest.microgames.forEach(function(A){e++});var t=e;function a(){A((t- --e)/t)}function n(A){console.error(A),--e<1&&alert("Loaded with errors!")}this.manifest.microgames.forEach(function(A){let e=new Promise((e,t)=>{PWGame.loadMicroGame(A,function(A){i.microgame_manifests.push(A),e()},function(A){alert("Microgame Failed:\n"+A+"\n\nDid you use the correct path?"),t()},void 0!==s&&s)});e.then(a,n)}),this.imgs.logo=new Image,this.imgs.logo.src="teams/"+this.manifest.logo.team+"/logos/"+this.manifest.logo.image,this.imgs.logo.onload=a,this.imgs.charsheet=new Image,this.imgs.charsheet.src="teams/"+this.manifest.character.team+"/characters/"+this.manifest.character.sheet,this.imgs.charsheet.onload=a,this.imgs.transsheet=new Image,this.imgs.transsheet.src="teams/"+this.manifest.transition.team+"/transitions/"+this.manifest.transition.sheet,this.imgs.transsheet.onload=a}hasIntro(){return!1}getRandomMicrogameManifest(){if(!this.manifest.microgames||0===this.manifest.microgames.length)return!1;if(this.microgame_manifests.length<1&&(this.microgame_manifests=this.microgame_manifests_used,this.microgame_manifests_used=[]),this.microgame_manifests.length<1)throw"Level has no microgame manifests loaded";var A=this.microgame_manifests.splice(Math.floor(Math.random()*this.microgame_manifests.length),1)[0];return this.microgame_manifests_used.push(A),A}getBossgameManifest(){return this.manifest.bossgame||!1}}PWLevel.default_manifest={logo:{team:"psychogoldfish",image:"sir_reginald_emojiman.png"},character:{team:"psychogoldfish",sheet:"sir_reginald_emojiman_sheet.webp",icon:"sir_reginald_emojiman_icon.png"},transition:{team:"psychogoldfish",sheet:"yellow_bricks.webp"},gamesPerRound:1,microgames:null,bossgame:null};class PWGameSceneloader extends Phaser.Scene{constructor(){super({key:"PWGameSceneloader"})}preload(){let t=this;PWGameSceneloader.manifests.forEach(e=>{e.images&&e.images.forEach(A=>{t.load.image(e.sceneClass+"."+A.key,e.path+A.image)})})}create(){PWGame.onManifestsLoaded(this)}}PWGameSceneloader.loaded={},PWGameSceneloader.manifests=[];class PWTransition{}