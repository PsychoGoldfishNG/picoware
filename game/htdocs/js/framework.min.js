var _Manifests={microgames:{psychogoldfish_tests:{push_the_button:{name:"Push the Button",sceneClass:"microgames.psychogoldfish_tests.push_the_button",input:"gamepad",hint:"Push Da Button!",jsFiles:["push-the-button.js"],images:[{key:"button_up",image:"button_up.png"},{key:"button_down",image:"button_down.png"},{key:"finger",image:"finger.png"}],credits:[{credit:"designer",name:"PsychoGoldfish"}]}}}};function loaderScript(s){return new Promise(function(A,t){let e=document.createElement("script");e.type="text/javascript",e.async=!0,e.addEventListener("error",t),e.addEventListener("load",A),e.src=s,document.head.appendChild(e)})}function containsAny(A,t){for(var e=0;e!=t.length;e++){var s=t[e];if(-1!=A.indexOf(s))return s}return null}var __safariSoundHack=(()=>{let e=document.createElement("audio");return document.body.appendChild(e),e.src="data:audio/x-wav;base64,UklGRooWAABXQVZFZm10IBAAAAABAAEAIlYAAESsAAACABAAZGF0YWYWAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA",(A,t)=>{e.onended=()=>{t?A.call(t):A()},e.play()}})();const BrowserHelper={isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)||/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.platform)},isIOS:function(){return this.isMobile()&&this.isSafari()},isSafari:function(){return-1<navigator.userAgent.indexOf("Safari")}},GameWrapper={view:"game",layoutDesktop:{baseWidth:960,baseHeight:540,screenSize:524,screenTop:8},layoutGBC:{baseWidth:720,baseHeight:1280,screenSize:524,screenTop:64,screenFrameWidth:662,screenFrameHeight:714,screenFrameTop:29,mainButtonFrameTop:775,mainButtonFrameHeight:212,mainButtonSize:140,mainButtonMargin:-7,smallButtonFrameTop:1058,smallButtonWidth:212,smallButtonHeight:55,smallButtonSize:92,inputMarginX:40,dPadSize:192,dPadDeadzone:10,AbButtonWidth:239,AbButtonHeight:162,speakerWidth:154,speakerHeight:162},layoutGBA:{baseWidth:1280,baseHeight:720,screenSize:524,screenTop:52,screenFrameWidth:654,screenFrameHeight:666,screenFrameTop:18,inputWidth:261,inputMarginX:46,inputTop:158,topInputHeight:236,bottomInputHeight:243,dPadSize:192,dPadDeadzone:10,AbButtonWidth:239,AbButtonHeight:162,mainButtonSize:140,mainButtonMargin:-7,smallButtonWidth:193,smallButtonHeight:144,smallButtonSize:59,smallButtonLeft:129,startButtonTop:17,selectButtonTop:81,ledTop:89,ledSize:56,speakerWidth:167,speakerHeight:134},getOffset:function(A){for(var t={top:0,left:0};isNaN(A.offsetLeft)||(t.left+=A.offsetLeft),isNaN(A.offsetTop)||(t.top+=A.offsetTop),A=A.offsetParent;);return t},init:function(A){var d=this;function u(A,t){return d.inputs[A].touch===t.identifier&&(d.inputs[A].touch=!1,"dpad"==A?(d.ui.up=!1,d.ui.down=!1,d.ui.left=!1,d.ui.right=!1,d.dPadHighlight.style.display="none"):(t=A.toLowerCase()+"Button",d[t].style.display="none",d.ui[A]=!1),d.onInputChanged.call(d.onInputChangedThisArg,d.ui),1)}function t(A){for(var t=0;t<A.changedTouches.length;t++){var e=A.changedTouches[t];if("touchcancel"==A.type||"touchend"==A.type)for(var[s,i]of Object.entries(d.inputs))u(s,e)&&A.preventDefault();else for(var[n,a]of Object.entries(d.inputs)){var o=Math.abs(e.clientX-a.x),r=Math.abs(e.clientY-a.y),h=a.size/2,l=9999;o<=h&&r<=h&&(l=Math.sqrt(o*o+r*r)),"dpad"===n&&l<a.deadzone||h<l?u(n,e)&&A.preventDefault:function(s,i){if("dpad"==s){d.inputs[s].touch=i.identifier;let A=0;for(var[n,a]of Object.entries(d.dirval))d.ui[n]&&(A+=a);d.ui.up=!1,d.ui.down=!1,d.ui.left=!1,d.ui.right=!1;let t=[];var o=Math.atan2(i.clientY-d.inputs.dpad.y,i.clientX-d.inputs.dpad.x)*d.rad2deg;-150<=o&&o<=-30?t.push("up"):o<=150&&30<=o&&t.push("down"),-60<=o&&o<=60?t.push("right"):(120<=o||o<=-120)&&t.push("left");let e=0;if(t.forEach(A=>{d.ui[A]=!0,e+=d.dirval[A]}),e===A)return;d.dPadHighlight.style.display="block",d.dPadHighlight.setAttribute("class",t.join("-"))}else{if(d.inputs[s].touch===i.identifier)return;d.inputs[s].touch=i.identifier;i=s.toLowerCase()+"Button";d[i].style.display="block",d.ui[s]=!0}return d.onInputChanged.call(d.onInputChangedThisArg,d.ui),1}(n,e)&&A.preventDefault}}}this.viewport=document.getElementById("viewport"),this.fader=document.getElementById("fader"),this.loadingSkin=document.getElementById("loading-skin"),this.loaderBar=document.getElementById("loader-bar"),this.gameplaySkin=document.getElementById("gameplay-skin"),this.uiElements=document.getElementById("ui-elements"),this.screenframe=document.getElementById("screenframe"),this.screenTransition=document.getElementById("screenTransition"),this.screen=document.getElementById("screen"),this.led=document.getElementById("led"),this.dPadFrame=document.getElementById("dpad-frame"),this.dPad=document.getElementById("dpad"),this.dPadHighlight=document.getElementById("dpad-highlight"),this.AbButtonsFrame=document.getElementById("ab-buttons-frame"),this.AbButtons=document.getElementById("ab-buttons"),this.aButton=document.getElementById("a-button"),this.bButton=document.getElementById("b-button"),this.startSelectButtonsFrame=document.getElementById("start-select-buttons-frame"),this.startSelectButtons=document.getElementById("start-select-buttons"),this.startButton=document.getElementById("start-button"),this.selectButton=document.getElementById("select-button"),this.speakerFrame=document.getElementById("speaker-frame"),this.speaker=document.getElementById("speaker"),this.character=document.getElementById("character"),this.screenHint=document.getElementById("screenHint"),this.hintText=document.getElementById("hintText"),this.hintShadow=document.getElementById("hintShadow"),this.rad2deg=180/Math.PI,this.dirval={up:1,down:2,left:4,right:8},this.ui={up:!1,right:!1,down:!1,left:!1,A:!1,B:!1,select:!1,start:!1},this.inputs={dpad:{x:0,y:0,size:0,touch:!1,deadzone:0},A:{x:0,y:0,size:0,touch:!1},B:{x:0,y:0,size:0,touch:!1},select:{x:0,y:0,size:0,touch:!1},start:{x:0,y:0,size:0,touch:!1}},window.addEventListener("resize",()=>{setTimeout(()=>{GameWrapper.updateGameScreenOrientation()},500)}),document.body.onclick=function(A){A.preventDefault()},document.ontouchstart=t,document.ontouchmove=t,document.ontouchend=t,document.ontouchcancel=t,this.onScreenUpdated=void 0!==A.onScreenUpdated?A.onScreenUpdated:function(A){},this.onScreenUpdatedThisArg=void 0!==A.onScreenUpdatedThisArg?A.onScreenUpdatedThisArg:this,this.onInputChanged=void 0!==A.onInputChanged?A.onInputChanged:function(A,t){},this.onInputChangedThisArg=void 0!==A.onInputChangedThisArg?A.onInputChangedThisArg:this,this.updateGameScreenOrientation()},resetGameElements:function(){document.body.setAttribute("class",""),this.uiElements.setAttribute("style",""),this.screenframe.setAttribute("style",""),this.screenTransition.setAttribute("style",""),this.gameplaySkin.setAttribute("class","gameplay-skin"),this.screen.setAttribute("style",""),this.led.setAttribute("style",""),this.dPadFrame.setAttribute("style",""),this.dPad.setAttribute("style",""),this.dPadHighlight.setAttribute("style","display:none"),this.AbButtonsFrame.setAttribute("style",""),this.AbButtons.setAttribute("style",""),this.aButton.setAttribute("style","display:none"),this.bButton.setAttribute("style","display:none"),this.startSelectButtonsFrame.setAttribute("style",""),this.startSelectButtons.setAttribute("style",""),this.startButton.setAttribute("style","display:none"),this.selectButton.setAttribute("style","display:none"),this.speakerFrame.setAttribute("style",""),this.speaker.setAttribute("style","")},viewGameMobileLandscape:function(A){this.resetGameElements(A);var t=this.layoutGBA,e=A.ew/t.baseWidth,s=A.eh/t.baseHeight,i=e<s?e:s;1.3<=i?document.body.setAttribute("class","zoom-1-3"):i<=.7?document.body.setAttribute("class","zoom-0-5"):i<=.9&&document.body.setAttribute("class","zoom-0-8");var n=2*Math.round(t.baseWidth*i/2),a=2*Math.round(t.baseHeight*i/2),o=(A.ew-n)/2,r=(A.eh-a)/2;this.gameplaySkin.style.width=n+"px",this.gameplaySkin.style.height=a+"px",this.gameplaySkin.style.top=r+"px",this.gameplaySkin.style.left=o+"px";var h=Math.ceil(t.screenFrameWidth*i),l=Math.ceil(t.screenFrameHeight*i),d=Math.round((n-h)/2),u=Math.round((a-l)*(t.screenFrameTop/(t.baseHeight-t.screenFrameHeight)));this.screenframe.style.width=h+"px",this.screenframe.style.height=l+"px",this.screenframe.style.top=u+"px",this.screenframe.style.left=d+"px";let c={size:2*Math.round(t.screenSize*i/2)};c.top=r+Math.round(t.screenTop*i),c.left=Math.round((A.ew-c.size)/2),this.screen.style.width=this.screen.style.height=c.size+"px",this.screen.style.top=c.top+"px",this.screen.style.left=c.left+"px";var m=Math.round(t.inputTop*i),p=Math.round(t.topInputHeight*i),g=Math.round(t.bottomInputHeight*i),y=Math.round(t.inputWidth*i),f=Math.round(t.dPadSize*i),b=Math.round(t.inputMarginX*i),B=Math.round(t.smallButtonWidth*i),w=Math.round(t.smallButtonHeight*i),S=Math.round(t.smallButtonSize*i),M=Math.round(t.smallButtonLeft*i),v=Math.round(t.mainButtonSize*i),x=Math.round(t.mainButtonMargin*i),e=Math.round(t.startButtonTop*i),s=Math.round(t.selectButtonTop*i),n=Math.round(t.AbButtonWidth*i),a=Math.round(t.AbButtonHeight*i),l=Math.round(t.ledTop*i),u=Math.round(t.ledSize*i);this.dPadFrame.style.width=this.AbButtonsFrame.style.width=this.startSelectButtonsFrame.style.width=this.speakerFrame.style.width=y+"px",this.dPadFrame.style.height=this.AbButtonsFrame.style.height=p+"px",this.startSelectButtonsFrame.style.height=this.speakerFrame.style.height=g+"px",this.dPadFrame.style.top=this.AbButtonsFrame.style.top=m+"px",this.startSelectButtonsFrame.style.top=this.speakerFrame.style.top=m+p+"px",this.dPadFrame.style.left=this.startSelectButtonsFrame.style.left=b+"px",this.AbButtonsFrame.style.right=this.speakerFrame.style.right=b+"px",this.dPad.style.width=this.dPad.style.height=f+"px",this.led.style.width=this.led.style.height=u+"px",this.led.style.left=d+h+"px",this.led.style.top=l+"px",this.AbButtons.style.width=n+"px",this.AbButtons.style.height=a+"px",this.aButton.style.width=this.aButton.style.height=this.bButton.style.width=this.bButton.style.height=v+"px",this.aButton.style.top=this.aButton.style.right=this.bButton.style.bottom=this.bButton.style.left=x+"px",this.startSelectButtons.style.width=B+"px",this.startSelectButtons.style.height=w+"px",this.startButton.style.width=this.startButton.style.height=this.selectButton.style.width=this.selectButton.style.height=S+"px",this.startButton.style.left=this.selectButton.style.left=M+"px",this.startButton.style.top=e+"px",this.selectButton.style.top=s+"px",this.speaker.style.width=Math.round(t.speakerWidth*i)+"px",this.speaker.style.height=Math.round(t.speakerHeight*i)+"px",this.inputs.dpad.x=b+y/2+o,this.inputs.dpad.y=m+p/2+r,this.inputs.dpad.size=f,this.inputs.dpad.deadzone=Math.floor(t.dPadDeadzone*i),this.inputs.start.x=b+M+(S+y-B)/2+o,this.inputs.start.y=m+p+e+(S+g-w)/2+r,this.inputs.start.size=S,this.inputs.select.x=b+M+(S+y-B)/2+o,this.inputs.select.y=m+p+s+(S+g-w)/2+r,this.inputs.select.size=S,this.inputs.A.x=A.ew-b-(v+y-n)/2-o,this.inputs.A.y=m+(v+p-a)/2+r,this.inputs.A.size=v,this.inputs.B.x=A.ew-b-y+(v+y-n)/2-o,this.inputs.B.y=m+p-(v+p-a)/2+r,this.inputs.B.size=v,this.onScreenUpdated.call(this.onScreenUpdatedThisArg,c)},viewGameMobilePortrait:function(A){this.resetGameElements(A);var t=this.layoutGBC,e=A.ew/t.baseWidth,s=A.eh/t.baseHeight,i=e<s?e:s;1.3<=i?document.body.setAttribute("class","zoom-1-3"):i<=.7?document.body.setAttribute("class","zoom-0-5"):i<=.9&&document.body.setAttribute("class","zoom-0-8");var n=2*Math.round(t.baseWidth*i/2),a=2*Math.round(t.baseHeight*i/2),o=(A.ew-n)/2,r=(A.eh-a)/2;this.gameplaySkin.style.width=n+"px",this.gameplaySkin.style.height=a+"px",this.gameplaySkin.style.top=r+"px",this.gameplaySkin.style.left=o+"px";var h=Math.ceil(t.screenFrameWidth*i),l=Math.ceil(t.screenFrameHeight*i),d=Math.round((n-h)/2),u=Math.round((a-l)*(t.screenFrameTop/(t.baseHeight-t.screenFrameHeight)));this.screenframe.style.width=h+"px",this.screenframe.style.height=l+"px",this.screenframe.style.top=u+"px",this.screenframe.style.left=d+"px";let c={size:2*Math.round(t.screenSize*i/2)};c.top=r+Math.round(t.screenTop*i),c.left=Math.round((A.ew-c.size)/2),this.screen.style.width=this.screen.style.height=c.size+"px",this.screen.style.top=c.top+"px",this.screen.style.left=c.left+"px";var m=Math.round(t.mainButtonFrameTop*i),p=Math.round(t.mainButtonFrameHeight*i),g=Math.round(t.mainButtonMargin*i),y=Math.round(t.mainButtonSize*i),f=(Math.round(t.smallButtonTop*i),Math.round(t.inputMarginX*i)),b=Math.round(t.dPadSize*i),e=(Math.round(t.dPadDeadzone*i),Math.round(t.AbButtonWidth*i)),s=Math.round(t.AbButtonHeight*i),n=Math.round(t.smallButtonFrameTop*i),a=Math.round(t.smallButtonWidth*i),h=Math.round(t.smallButtonHeight*i),l=Math.round(t.smallButtonSize*i),u=Math.round(t.speakerWidth*i),d=Math.round(t.speakerHeight*i);this.dPadFrame.style.top=this.AbButtonsFrame.style.top=m+"px",this.dPadFrame.style.height=this.AbButtonsFrame.style.height=p+"px",this.dPadFrame.style.left=f+"px",this.AbButtonsFrame.style.right=f+"px",this.dPad.style.width=this.dPad.style.height=b+"px",this.AbButtons.style.width=e+"px",this.AbButtons.style.height=s+"px",this.startSelectButtonsFrame.style.top=this.speakerFrame.style.top=n+"px",this.startSelectButtons.style.width=a+"px",this.startSelectButtons.style.height=h+"px",this.startButton.style.top=this.selectButton.style.top=(h-l)/2+"px",this.startButton.style.width=this.startButton.style.height=this.selectButton.style.width=this.selectButton.style.height=l+"px",this.startButton.style.right=this.selectButton.style.left="0px",this.speaker.style.width=u+"px",this.speaker.style.height=d+"px",this.speaker.style.right=f+"px",this.inputs.dpad.x=f+b/2+o,this.inputs.dpad.y=m+p/2+r,this.inputs.dpad.size=b,this.inputs.dpad.deadzone=Math.floor(t.dPadDeadzone*i),this.inputs.select.x=(A.ew-a+l)/2,this.inputs.select.y=n+h/2+r,this.inputs.select.size=l,this.inputs.start.x=(A.ew+a-l)/2,this.inputs.start.y=n+h/2+r,this.inputs.start.size=l,this.inputs.A.x=A.ew-f-g-y/2-o,this.inputs.A.y=m+g+(p-s+y)/2+r,this.inputs.A.size=y,this.inputs.B.x=A.ew-f-e+g+y/2-o,this.inputs.B.y=m+p-g-(p-s+y)/2+r,this.inputs.B.size=y,this.aButton.style.width=this.aButton.style.height=this.bButton.style.width=this.bButton.style.height=y+"px",this.aButton.style.top=this.aButton.style.right=this.bButton.style.bottom=this.bButton.style.left=g+"px",this.onScreenUpdated.call(this.onScreenUpdatedThisArg,c)},viewGameDesktop:function(A){this.resetGameElements(A);var t=this.layoutDesktop,e=A.ew/t.baseWidth,s=A.eh/t.baseHeight,i=e<s?e:s,n=2*Math.round(t.baseWidth*i/2),a=2*Math.round(t.baseHeight*i/2),e=(A.ew-n)/2,s=(A.eh-a)/2;this.gameplaySkin.style.width=n+"px",this.gameplaySkin.style.height=a+"px",this.gameplaySkin.style.top=s+"px",this.gameplaySkin.style.left=e+"px";let o={size:2*Math.round(t.screenSize*i/2)};o.top=s+Math.round(t.screenTop*i),o.left=Math.round((A.ew-o.size)/2),this.screen.style.width=this.screen.style.height=o.size+"px",this.screen.style.top=o.top+"px",this.screen.style.left=o.left+"px";Math.round(t.characterWidth*i),Math.round(t.characterHeight*i);this.onScreenUpdated.call(this.onScreenUpdatedThisArg,o)},showLoadScreen(){this.loadingSkin.style.display=""},setLoadedValue(A){this.loaderBar.style.width=Math.round(100*A)+"%"},hideLoadScreen(){this.loadingSkin.style.display="none"},fadeIn(){this.fader.style.opacity="0"},fadeOut(){this.fader.style.opacity="1"},crossFade(A,t){this.fadeOut(),setTimeout(()=>{this.fadeIn(),A&&A(),t&&setTimeout(()=>{t()},500)},500)},setHintText:function(A){this.hintText.innerHTML=this.hintShadow.innerHTML="",this.screenHint.style.fontSize="",this.screenHint.style.display="",this.screenHint.style.transition="",this.screenHint.style.transitionTimingFunction="";let t=Math.floor(this.screenHint.offsetHeight);this.screenHint.style.fontSize=t+"px",this.hintText.textContent=this.hintShadow.textContent=A,this.screenHint.style.top="-"+2*t+"px";let e=this;setTimeout(()=>{e.screenHint.style.transition="0.2s",e.screenHint.style.transitionTimingFunction="ease-out",e.screenHint.style.top=""},1),setTimeout(()=>{e.screenHint.style.transition="0.2s",e.screenHint.style.transitionTimingFunction="ease-in",e.screenHint.style.top="-"+2*t+"px"},800)},transitionImage:new Image,transitionSize:524,transitionZoom:1,transitionFrame:1,transitionFramerates:{a:8,b:8},exitTransition:function(A,t,e){if(!A)throw"Missing required callback";this.screenTransition.style.display="";let s=((t=t||2)-1)/((e=e||250)/(1e3/60)),i=this;i.setTransitionZoom(1,5);let n=setInterval(function(){i.transitionZoom>=t?(clearInterval(n),A()):i.setTransitionZoom(i.transitionZoom+s,5)},1e3/60)},enterTransition:function(A,t,e){if(!A)throw"Missing required callback";this.screenTransition.style.display="";let s=((t=t||2)-1)/((e=e||250)/(1e3/60)),i=this;i.setTransitionZoom(t,5);let n=setInterval(function(){1===t?(clearInterval(n),A()):((t-=s)<1&&(t=1),i.setTransitionZoom(t,5))},1e3/60)},playTransitionIdle:function(A,t,e){if(!A)throw"Missing required callback";this.screenTransition.style.display="",e=e||1500,t=t||8;let s=this,i=setInterval(function(){s.setTransitionFrame(1===s.transitionFrame?2:1)},1e3/t);setTimeout(function(){clearInterval(i),A()},e)},playTransitionOpen:function(A,t,e){if(!A)throw"Missing required callback";this.screenTransition.style.display="",e=e||500,t=t||15;let s=this;this.setTransitionFrame(3);let i=setInterval(function(){s.setTransitionFrame(s.transitionFrame+1),4<s.transitionFrame&&clearInterval(i)},1e3/t);setTimeout(function(){clearInterval(i),A()},e)},playTransitionClose:function(A,t,e){if(!A)throw"Missing required callback";this.screenTransition.style.display="",t=t||15;let s=this;this.setTransitionFrame(5);let i=setInterval(function(){s.setTransitionFrame(s.transitionFrame-1),s.transitionFrame<3&&(clearInterval(i),A())},1e3/t)},setTransitionImage:function(A){if(!A.src||!A.naturalHeight)throw"Image not loaded!";this.transitionImage=A,this.screenTransition.style.background='url("'+this.transitionImage.src+'")',this.screenTransition.style.backgroundColor="rgba(0,0,0,0.01)",this.setTransitionZoom(1)},setTransitionZoom(A,t){if(!this.transitionImage.src||!this.transitionImage.naturalHeight)throw"Image not loaded!";this.transitionZoom=A,this.transitionSize=Math.ceil(this.screenTransition.offsetHeight*A);var e=5*this.transitionSize,A=this.transitionSize;this.screenTransition.style.backgroundSize=e+"px "+A+"px",this.setTransitionFrame(void 0!==t?t:null)},setTransitionFrame:function(A){if(!this.transitionImage.src||!this.transitionImage.naturalHeight)throw"Image not loaded!";if((A=null===A?1:A)<1||5<A)throw"Frame must be a number between 1 and 5";this.transitionFrame=A;var t=(this.screenTransition.offsetHeight-this.transitionSize)/2,A=-((this.transitionFrame-1)*this.transitionSize-t);this.screenTransition.style.backgroundPosition="top "+t+"px left "+A+"px"},endTransition:function(){this.screenTransition.style.display="none"},getWindowSize:function(){var A={orientation:"desktop"};let t=document.createElement("div");return t.style.cssText="position:fixed;width:100%;height:100%;top:0px;left:0px",document.body.appendChild(t),BrowserHelper.isMobile()&&(A.orientation=t.clientWidth>t.clientHeight?"landscape":"portrait"),window.screen.width>window.screen.height&&"portrait"==A.orientation||window.screen.width<window.screen.height&&"landscape"==A.orientation?(A.width=window.screen.height,A.height=window.screen.width):(A.width=window.screen.width,A.height=window.screen.height),A.ew=t.clientWidth,A.eh=t.clientHeight,t.parentNode.removeChild(t),A},updateGameScreenOrientation:function(){var A=GameWrapper.getWindowSize();"game"===this.view&&("landscape"===A.orientation?GameWrapper.viewGameMobileLandscape(A):"portrait"===A.orientation?GameWrapper.viewGameMobilePortrait(A):GameWrapper.viewGameDesktop(A),this.gameplaySkin.setAttribute("class","gameplay-skin "+A.orientation))}};class PWInput{constructor(){let s=this;this.reset(),this.keyMap_arrows={up:"ArrowUp",right:"ArrowRight",down:"ArrowDown",left:"ArrowLeft",B:"KeyS",A:"KeyA",select:"KeyZ",start:"KeyX"},this.keyMap_wasd={up:"KeyW",right:"KeyD",down:"KeyS",left:"KeyA",B:"KeyO",A:"KeyP",select:"KeyK",start:"KeyL"},this.setKeyMap("arrows"),document.addEventListener("keydown",function(A){for(var[t,e]of Object.entries(s.keyMap))if(A.code==e){s.setInputState(t,!0,A);break}}),document.addEventListener("keyup",function(A){for(var[t,e]of Object.entries(s.keyMap))if(A.code==e){s.setInputState(t,!1,A);break}})}setKeyMap(A){this.keyMap={};for(var[t,e]of Object.entries(this["keyMap_"+A]))this.mapKey(e,t)}mapKey(A,t){this.keyMap[t]=A}reset(){this.inputs={up:!1,right:!1,down:!1,left:!1,B:!1,A:!1,select:!1,start:!1},this._onPress={},this._onPressThisArg={},this._onRelease={},this._onReleaseThisArg={},this._aliases={},this._alias_map={}}setAlias(t,A){let e=this;(A="string"==typeof A?[A]:A).forEach(A=>{e._aliases[A]||(e._aliases[A]=[]),e._aliases[A].indexOf(t)<0&&e._aliases[A].push(t)}),this._alias_map[t]=A,console.log(this._aliases)}isDown(A){if(this._alias_map[A]){for(var t in this._alias_map[A])if(this.inputs[this._alias_map[A][t]])return!0;return!1}return void 0!==this.inputs[A]&&this.inputs[A]}onPress(A,t,e){this._onPressThisArg[A]=void 0!==e?e:this,this._onPress[A]=t}onRelease(A,t,e){this._onReleaseThisArg[A]=void 0!==e?e:this,this._onRelease[A]=t}setInputState(A,e,s){if(this.checkInputState(A,e,s),this._aliases[A]){let t=this;this._aliases[A].forEach(function(A){t.checkInputState(A,e,s)})}}checkInputState(A,t,e){this.inputs[A]!==t&&((this.inputs[A]=t)&&this._onPress[A]?this._onPress[A].call(this._onPressThisArg[A],A,e):!t&&this._onRelease[A]&&this._onRelease[A].call(this._onReleaseThisArg[A],A,e))}onLayoutInputChanged(A){var t,e;for([t,e]of Object.entries(A))e!==this.inputs[t]&&this.setInputState(t,e,null)}}PWInput.PLAYMODE_GAMEPAD="gamepad",PWInput.PLAYMODE_TOUCH="touch";class PWFramework{constructor(A){this.usermode=A,this.screensize=524,this.screen=null,this.paused=!1,this.in_transition=!1,this.targetFPS=60,this.gameSpeed=PWConfig.SPEED_NORMAL,this.msPerTargetFrame=null,this.input=new PWInput,this.onManifestsLoaded=()=>{},this.setGameSpeed(this.gameSpeed)}start(){let A=this;GameWrapper.init({onScreenUpdated:this.onScreenUpdated,onScreenUpdatedThisArg:this,onInputChanged:this.input.onLayoutInputChanged,onInputChangedThisArg:this.input}),this.phaser=new Phaser.Game({parent:"screen",type:Phaser.AUTO,width:this.screensize,height:this.screensize,id:"PhaserCanvas",backgroundColor:"#8ba05b",scene:{create:function(){A.phaser.scene.add("PWGameSceneloader",new PWGameSceneloader),"dev"===A.usermode&&A.startDevScreen()}}})}onScreenUpdated(A){this.screen=A,this.phaser&&this.phaser.canvas&&(this.phaser.canvas.style.width=A.size+"px",this.phaser.canvas.style.height=A.size+"px")}startDevScreen(){let e=this,s=document.getElementById("dev-interface");document.getElementById("level-path"),document.getElementById("load-level-path");let A=document.getElementById("game-path"),t=document.getElementById("load-game-path");s.style.display="",this.phaser.canvas.style.display="none",GameWrapper.gameplaySkin.style.display="none",GameWrapper.fadeIn(),t.onclick=function(t){t.preventDefault(),t.stopPropagation();t=2!==(t=(t=A.value).split("/")).length?(console.error("Invalid path!",t),alert("Invalid path!"),!1):t;if(t){let A={logo:"img/devmode_icon.webp",microgames:[t],gamesPerRound:1,devMode:!0};s.style.pointerEvents="none",GameWrapper.crossFade(function(){s.style.display="none",s.style.pointerEvents="",e.startLevel(A)})}}}startLevel(A){this.in_transition=!0;let t=this;this.level=new PWLevel(A),this.showGameLayout(),GameWrapper.showLoadScreen(),GameWrapper.setLoadedValue(0),this.level.preload(function(A){GameWrapper.setLoadedValue(A),1===A&&GameWrapper.crossFade(()=>{GameWrapper.hideLoadScreen(),GameWrapper.setTransitionImage(t.level.imgs.transsheet),t.level.hasIntro()?t.level.playIntro(function(){t.nextPhase()}):t.nextPhase()})},!0),this.level.onGameComplete(function(){t.nextPhase(!0)})}showGameLayout(){GameWrapper.updateGameScreenOrientation(),GameWrapper.gameplaySkin.style.display="",this.phaser.canvas.style.display=""}nextPhase(n){let a=this;this.level.getNext(function(A,t){let e=null,s=null;switch(a.in_transition=!0,A){case"microgame":e=t;break;case"newround":var i;"bossgame"===t?s="Boss Level!":(s="Faster!",i=[null,PWConfig.SPEED_NORMAL,PWConfig.SPEED_FASTER,PWConfig.SPEED_FASTEST],a.setGameSpeed(i[a.level.round]))}e?n?GameWrapper.enterTransition(function(){GameWrapper.playTransitionClose(function(){a.nextGame(e)})}):a.nextGame(e):s&&GameWrapper.enterTransition(function(){GameWrapper.setHintText(s),GameWrapper.playTransitionClose(function(){a.nextPhase(!1)})})})}nextGame(A){let t=this;GameWrapper.playTransitionIdle(function(){t.startActualGame(A),GameWrapper.setHintText(A.hint),GameWrapper.playTransitionOpen(function(){GameWrapper.exitTransition(function(){t.in_transition=!1,GameWrapper.endTransition()})})})}startActualGame(A){this.input.reset(),this.phaser.scene.start(A.sceneClass)}loadMicroGame(A,n,a,t){let o=this;!0===a&&(t=!0,a=function(){}),a=void 0!==a?a:function(A){alert(A)},this.loadMicroGameManifest(A,function(s,i){let t=[];if(["name","jsFiles","sceneClass","input","hint"].forEach(function(A){void 0===s[A]&&t.push("Missing required property in manifest.json: '"+A+"'")}),0<t.length)a(t.join("\n"));else{let e;try{e=o.getSceneClass(s.sceneClass)}catch(A){e=null}if(e)o.registerScene(e,s),o.preloadManifests([s],()=>{n(s)});else{let t=s.jsFiles.length;s.jsFiles.forEach(A=>{loaderScript(i+A).then(()=>{if(t--,t<=0)try{e=o.getSceneClass(s.sceneClass),o.registerScene(e,s),o.preloadManifests([s],()=>{n(s)})}catch(A){a(A)}}).catch(A=>{console.error(A),a(A)})})}}},a,t)}preloadManifests(A,t){this.onManifestsLoaded=void 0!==t?t:function(){},A.forEach(A=>{PWGameSceneloader.manifests.push(A)}),this.phaser.scene.start("PWGameSceneloader")}loadMicroGameManifest(t,e,s,A){_Manifests.microgames[t[0]]=void 0!==_Manifests.microgames[t[0]]?_Manifests.microgames[t[0]]:{},!0===s&&(A=!0,s=function(){}),s=void 0!==s?s:function(A){alert(A)};let i="microgames/"+t[0]+"/"+t[1]+"/";A||!_Manifests.microgames[t[0]][t[1]]?this.getJSON(i+"manifest.json",function(A){A.path=i,_Manifests.microgames[t[0]][t[1]]=A,e(_Manifests.microgames[t[0]][t[1]],i)},function(A){console.error(A),console.error("Couldn't find file: microgames/"+t[0]+"/"+t[1]+"/manifest.json"),s("Could not load game at "+t[0]+"/"+t[1])}):(_Manifests.microgames[t[0]][t[1]].path=i,e(_Manifests.microgames[t[0]][t[1]],"microgames/"+t[0]+"/"+t[1]+"/"))}getJSON(A,t,e,s){"function"==typeof t&&(s=e,e=t,t=null),e=void 0!==e?e:function(){},s=void 0!==s?s:function(A){console.error(A),alert(A)},this.get(A,t,function(A){try{var t=JSON.parse(A);e(t)}catch(A){s(A)}},s)}get(A,t,e,s){if("function"==typeof t&&(s=e,e=t,t=null),e="function"==typeof e?e:function(){},s=void 0!==s?s:function(A){console.error(A),alert(A)},t&&"object"==typeof t){let A=[];for(var[i,n]of Object.entries(t))A.push(encodeURIComponent(i)+"="+encodeURIComponent(n));t="?"+A.join("&")}else t="";var a=new XMLHttpRequest;a.onreadystatechange=function(){4==this.readyState&&(200==this.status?e(this.responseText):s(this.responseText,this.status))},a.open("GET",A+t,!0),a.send()}registerScene(A,t){PWGameSceneloader.loaded[t.sceneClass]||(PWGameSceneloader.loaded[t.sceneClass]=A,this.phaser.scene.add(t.sceneClass,new A))}getSceneClass(A){let t=null,e=[],s=A.split(".");var i=s.shift();if("microgames"===i)t=microgames;else{if("bossgames"!==i)throw"Scene class must be namespaced to microgames or bossgames!";t=bossgames}for(e.push(i);0<s.length;){var n=s.shift();if(e.push(n),t=void 0!==t[n]?t[n]:null,!t)throw e.join(".")+" is undefined."}if(t.prototype instanceof Phaser.Scene)return t;throw A+" is either not an extension of Phaser.Scene, or there are errors in the class file."}isReady(){return!this.in_transition&&!this.paused}setGameSpeed(A){this.gameSpeed=A,this.msPerTargetFrame=1e3/(this.targetFPS*A)}getDeltaMultiplier(A){return A/this.msPerTargetFrame}lostGame(){this.level.gameCompleted(!1)}wonGame(){this.level.gameCompleted(!0)}}const microgames={},bossgames={},PWConfig={SPEED_NORMAL:1,SPEED_FASTER:1.25,SPEED_FASTEST:1.5},PWGame=new PWFramework("dev");class PWCharacter{}class PWLevel{constructor(A){if(console.log("NEW MANIFEST",A),!A)throw"Missing required manifest!";if(this.devMode=!1,A.devMode){this.devMode=!0;for(var[t,e]of Object.entries(PWLevel.default_manifest))void 0===A[t]&&(A[t]=e)}if(!A.character)throw"Missing required character!";if(!A.transition)throw"Missing required transition!";if(!A.microgames)throw"Missing required microgame array!";this.round=1,this.gamesPerRound=void 0!==A.gamesPerRound?A.gamesPerRound:5,this.currentGame=0,this.gamesRemaining=this.gamesPerRound,this.microgame_manifests=[],this.microgame_manifests_used=[],this.manifest=A,this.imgs={logo:new Image,character:new Image,transition:new Image}}getNext(A){if(console.log("round:",this.round),console.log("gamesRemaining:",this.gamesRemaining+"/"+this.gamesPerRound),this.round<4)if(this.manifest.microgames&&0!==this.manifest.microgames.length){if(!(0<this.gamesRemaining))return this.round++,this.gamesRemaining=this.gamesPerRound,console.log("newround!!!"),void A("newround",this.round<4?"microgame":"bossgame");console.log(this.gamesRemaining+" games left (--)"),this.gamesRemaining--}else console.log("skip microgames"),this.round=4;this.round<4?(console.log("start micro!"),A("microgame",this.getRandomMicrogameManifest())):4===this.round&&this.manifest.bossgame?(console.log("start boss!"),A("bossgame",this.getBossgameManifest())):(console.log("winner?"),A("finish",null))}onGameComplete(A){this.game_complete_callback=A}gameCompleted(A){this.game_complete_callback&&this.game_complete_callback(A)}preload(A,s){let i=this;var t=3;this.manifest.microgames.forEach(function(A){t++});var e=t;function n(){A((e- --t)/e)}function a(A){console.error(A),--t<1&&alert("Loaded with errors!")}this.manifest.microgames.forEach(function(e){let A=new Promise((t,A)=>{PWGame.loadMicroGame(e,function(A){i.microgame_manifests.push(A),t()},A,void 0!==s&&s)});A.then(n,a)}),this.imgs.logo=new Image,this.imgs.logo.src=void 0!==this.manifest.logo?this.manifest.logo:"FIXME!!!",this.imgs.logo.onload=n,this.imgs.charsheet=new Image,this.imgs.charsheet.src="characters/"+this.manifest.character,this.imgs.charsheet.onload=n,this.imgs.transsheet=new Image,this.imgs.transsheet.src="transitions/"+this.manifest.transition,this.imgs.transsheet.onload=n}hasIntro(){return!1}getRandomMicrogameManifest(){if(!this.manifest.microgames||0===this.manifest.microgames.length)return!1;if(this.microgame_manifests.length<1&&(this.microgame_manifests=this.microgame_manifests_used,this.microgame_manifests_used=[]),this.microgame_manifests.length<1)throw"Level has no microgame manifests loaded";var A=this.microgame_manifests.splice(Math.floor(Math.random()*this.microgame_manifests.length),1)[0];return this.microgame_manifests_used.push(A),A}getBossgameManifest(){return this.manifest.bossgame||!1}}PWLevel.default_manifest={character:"angry_face/psychogoldfish_stickman.webp",transition:"angry_face/psychogoldfish_bricks.webp",gamesPerRound:1,microgames:null,bossgame:null};class PWGameSceneloader extends Phaser.Scene{constructor(){super({key:"PWGameSceneloader"})}preload(){let e=this;PWGameSceneloader.manifests.forEach(t=>{t.images&&t.images.forEach(A=>{e.load.image(t.sceneClass+"."+A.key,t.path+A.image)})})}create(){PWGame.onManifestsLoaded(this)}}PWGameSceneloader.loaded={},PWGameSceneloader.manifests=[];class PWTransition{}